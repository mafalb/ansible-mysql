# vim: set ft=yaml ts=2:
---
- hosts: cihost
  vars_files:
    - vars/main.yml
  roles:
    - role: mafalb.ansible_ci/node
      ansible_ci_test_name: mariadb1
      ansible_ci_node_type: docker
      ansible_ci_node_image_name: centos7

- hosts: mariadb1
  roles:
    - role: mafalb.mysql/server
  tasks:
    - name: check if we can login
      changed_when: false
      command: mysql -e 'show databases'

    - name: check that we cant login without password
      changed_when: false
      register: _mafalb_mysql_login
      failed_when: _mafalb_mysql_login.rc == 0
      command: mysql -e 'show databases' -p,fCkRZn6_95kH3i,9uG-

    - name: we can create a database (we can authenticate)
      mysql_db:
        name: gugu

    # note: implicit we are testing that client binaries are installed
    - name: we can query the new database
      command: mysql -e 'select true' gugu
...
