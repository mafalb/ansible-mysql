# vim: set ft=yaml ts=2:
---
- hosts: cihost
  vars_files:
    - vars/main.yml
  roles:
    - role: mafalb.ansible_ci/node
      ansible_ci_test_name: mysql_community_1
      ansible_ci_node_type: docker
      ansible_ci_node_image_name: centos7
    - role: mafalb.ansible_ci/node
      ansible_ci_test_name: mysql_community_2
      ansible_ci_node_type: docker
      ansible_ci_node_image_name: centos7

- hosts: mysql_community_1
  roles:
    - role: mafalb.mysql/server
      mysql_type: mysql_community
      mysql_version: 5.5
- hosts: mysql_community_2
  roles:
    - role: mafalb.mysql/server
      mysql_type: mysql_community
      mysql_version: 5.6

- hosts: mysql_community_1,mysql_community_2
  tasks:
    - name: check if we can login
      changed_when: false
      command: mysql -e 'show databases'

    - name: check that we cant login without password
      changed_when: false
      register: _mafalb_mysql_login
      failed_when: _mafalb_mysql_login.rc == 0
      command: mysql -e 'show databases' -p,fCkRZn6_95kH3i,9uG-

    - name: we can create a database (we can authenticate)
      mysql_db:
        name: gugu

    # note: implicit we are testing that client binaries are installed
    - name: we can query the new database
      changed_when: false
      command: mysql -e 'select true' gugu
...
